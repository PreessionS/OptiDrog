<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>Premium - OptiDrog</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="premium-page">
        <section class="premium-hero">
            <h1>OptiDrog Premium</h1>
            <p class="premium-hero-subtitle">
                PozbÄ…dÅº siÄ™ reklam i odblokuj peÅ‚nÄ… moc planowania tras z OptiDrog Premium.
            </p>
            <ul class="premium-hero-benefits">
                <li><span>ğŸš«</span> Brak reklam</li>
                <!--<li><span>â˜ï¸</span> Auto-synchronizacja</li>-->
                <li><span>ğŸš€</span> Priorytetowe wsparcie</li>
            </ul>
        </section>

        <section class="premium-plans">
            <h2>Wybierz plan</h2>
            <div class="plan-grid">
                <article class="plan-card" data-plan="miesiac_premium">
                    <!-- UWAGA: Zmieniono z "premium_month" na "miesiac_premium" dla zgodnoÅ›ci z Google Play Console -->
                    <p class="plan-label">Elastyczny</p>
                    <h3>MiesiÄ™czny</h3>
                    <p class="plan-price">10 zÅ‚<span>/ miesiÄ…c</span></p>
                    <ul class="plan-features">
                        <li>Brak reklam natychmiast po zakupie</li>
                        <li>PeÅ‚na kontrola nad odnawianiem</li>
                    </ul>
                    <button class="plan-button" data-plan-id="miesiac_premium">Aktywuj</button>
                </article>

                <article class="plan-card accent" data-plan="rok_subskrybcja">
                    <!-- UWAGA: Zmieniono z "premium_year" na "rok_subskrybcja" dla zgodnoÅ›ci z Google Play Console -->
                    <p class="plan-label">Najlepsza wartoÅ›Ä‡</p>
                    <h3>Roczny</h3>
                    <p class="plan-price">100 zÅ‚<span>/ rok</span></p>
                    <p class="plan-save">OszczÄ™dzasz 20 zÅ‚</p>
                    <ul class="plan-features">
                        <li>StaÅ‚y dostÄ™p do wszystkich funkcji premium</li>
                    </ul>
                    <button class="plan-button" data-plan-id="rok_subskrybcja">Aktywuj</button>
                </article>
            </div>
        </section>

        <section class="premium-benefits">
            <div class="benefit-card">
                <h3>Natychmiastowa aktywacja</h3>
                <p>Premium wÅ‚Ä…cza siÄ™ od razu po potwierdzeniu zakupu i obejmuje wszystkie urzÄ…dzenia korzystajÄ…ce z
                    Twojego konta Google.</p>
            </div>
            <div class="benefit-card">
                <h3>Automatyczne przywracanie</h3>
                <p>Po reinstalacji aplikacji status premium zostanie automatycznie przywrÃ³cony. MoÅ¼esz teÅ¼ uÅ¼yÄ‡
                    przycisku â€PrzywrÃ³Ä‡ zakupâ€.</p>
            </div>
            <div class="benefit-card">
                <h3>Bezpieczne pÅ‚atnoÅ›ci</h3>
                <p>Wszystkie transakcje realizowane sÄ… przez Google Play Billing â€“ bezpiecznie i zgodnie z zasadami
                    sklepu Play.</p>
            </div>
        </section>

        <section class="premium-faq">
            <h2>NajczÄ™stsze pytania</h2>
            <div class="faq-item">
                <h4>Jak dezaktywowaÄ‡ odnowienie?</h4>
                <p>PrzejdÅº do Google Play &gt; PÅ‚atnoÅ›ci i subskrypcje &gt; Subskrypcje. Wybierz OptiDrog i wyÅ‚Ä…cz
                    automatyczne odnawianie.</p>
            </div>
            <div class="faq-item">
                <h4>Co jeÅ›li reinstalujÄ™ aplikacjÄ™?</h4>
                <p>Po uruchomieniu aplikacja automatycznie sprawdzi aktywne subskrypcje i przywrÃ³ci status premium.</p>
            </div>
            <div class="faq-item">
                <h4>Czy reklamy zniknÄ…?</h4>
                <p>Tak. Po aktywacji premium reklamy sÄ… natychmiast wyÅ‚Ä…czone we wszystkich moduÅ‚ach aplikacji.</p>
            </div>
        </section>

        <section class="premium-restore">
            <h2>PrzywrÃ³Ä‡ zakup</h2>
            <p>JeÅ›li masz juÅ¼ aktywnÄ… subskrypcjÄ™ na swoim koncie Google, uÅ¼yj przycisku poniÅ¼ej, aby ponownie jÄ…
                aktywowaÄ‡.</p>
            <button class="secondary-button" id="restore-premium">PrzywrÃ³Ä‡ premium</button>
        </section>

        <!-- Sekcja zarzÄ…dzania subskrypcjÄ… - widoczna tylko dla aktywnych uÅ¼ytkownikÃ³w -->
        <section class="premium-manage" id="premium-manage-section" style="display: none;">
            <h2>ZarzÄ…dzaj subskrypcjÄ…</h2>
            <p>Twoja subskrypcja OptiDrog Premium odnawia siÄ™ <strong>automatycznie</strong>, aby zapewniÄ‡ ciÄ…gÅ‚y dostÄ™p
                do wszystkich funkcji premium.</p>
            <p class="manage-info">MoÅ¼esz w kaÅ¼dej chwili zarzÄ…dzaÄ‡ swojÄ… subskrypcjÄ…, zmieniÄ‡ plan lub anulowaÄ‡
                automatyczne odnawianie:</p>
            <ul class="manage-options">
                <li>â€¢ Kliknij przycisk poniÅ¼ej, aby zarzÄ…dzaÄ‡ subskrypcjÄ… w Google Play</li>
                <li>â€¢ Lub przejdÅº bezpoÅ›rednio do Google Play â†’ PÅ‚atnoÅ›ci i subskrypcje â†’ OptiDrog</li>
            </ul>
            <div class="manage-note">
                <p><strong>Uwaga:</strong> Anulowanie subskrypcji nie oznacza utraty dostÄ™pu do premium natychmiast.
                    BÄ™dziesz mÃ³gÅ‚ korzystaÄ‡ z funkcji premium do koÅ„ca obecnego okresu rozliczeniowego.</p>
            </div>
            <button class="manage-button" id="manage-subscription">ZarzÄ…dzaj subskrypcjÄ…</button>
        </section>

        <div id="premium-expiry-details"
            style="display: none; margin: 20px 0; padding: 15px; background-color: #f5f5f5; border-radius: 8px;"></div>
    </div>

    <script src="components.js"></script>
    <script>
        (function () {
            const premiumPage = {
                init() {
                    this.bindPlanButtons();
                    this.bindRestore();
                    this.bindManageSubscription();
                    const status = window.premium?.currentStatus;
                    if (status) {
                        this.onStatusChanged(status);
                    } else {
                        window.premium?.requestStatus();
                    }
                },
                bindPlanButtons() {
                    document.querySelectorAll('[data-plan-id]').forEach(button => {
                        button.addEventListener('click', () => {
                            // SprawdÅº bezpoÅ›rednio status subskrypcji z globalnego obiektu
                            const status = window.premium?.currentStatus;
                            const isSubscriptionActive = status && status.isActive;

                            if (isSubscriptionActive) {
                                // JeÅ›li subskrypcja jest juÅ¼ aktywna, pokaÅ¼ komunikat zamiast rozpoczynaÄ‡ zakup
                                this.showMessage('Posiadasz juÅ¼ aktywnÄ… subskrypcjÄ™ Premium!', false);
                                return;
                            }

                            const planId = button.getAttribute('data-plan-id');
                            if (typeof Android !== 'undefined' && typeof Android.startPremiumPurchase === 'function') {
                                Android.startPremiumPurchase(planId);
                            } else {
                                console.warn('Interfejs Android nie jest dostÄ™pny.');
                            }
                        });
                    });
                },
                bindManageSubscription() {
                    const manageBtn = document.getElementById('manage-subscription');
                    if (!manageBtn) return;

                    manageBtn.addEventListener('click', () => {
                        if (typeof Android !== 'undefined' && typeof Android.manageSubscription === 'function') {
                            // WÅ‚Ä…cz loading state
                            manageBtn.disabled = true;
                            manageBtn.textContent = 'Otwieranie...';
                            manageBtn.classList.add('loading');

                            Android.manageSubscription();

                            // Automatycznie wyÅ‚Ä…cz loading po 3 sekundach
                            setTimeout(() => {
                                if (manageBtn.disabled) {
                                    manageBtn.disabled = false;
                                    manageBtn.textContent = 'ZarzÄ…dzaj subskrypcjÄ…';
                                    manageBtn.classList.remove('loading');
                                }
                            }, 3000);
                        } else {
                            console.warn('Interfejs Android do zarzÄ…dzania subskrypcjÄ… nie jest dostÄ™pny.');
                        }
                    });
                },
                bindRestore() {
                    const restoreBtn = document.getElementById('restore-premium');
                    if (!restoreBtn) return;
                    restoreBtn.addEventListener('click', () => {
                        if (typeof Android !== 'undefined' && typeof Android.restorePremium === 'function') {
                            // WÅ‚Ä…cz loading state
                            restoreBtn.disabled = true;
                            restoreBtn.textContent = 'Przywracanie...';
                            restoreBtn.classList.add('loading');

                            Android.restorePremium();

                            // Automatycznie wyÅ‚Ä…cz loading po 10 sekundach (zabezpieczenie)
                            setTimeout(() => {
                                if (restoreBtn.disabled) {
                                    restoreBtn.disabled = false;
                                    restoreBtn.textContent = 'PrzywrÃ³Ä‡ premium';
                                    restoreBtn.classList.remove('loading');
                                }
                            }, 10000);
                        }
                    });
                },
                resetRestoreButton() {
                    const restoreBtn = document.getElementById('restore-premium');
                    if (!restoreBtn) return;
                    restoreBtn.disabled = false;
                    restoreBtn.textContent = 'PrzywrÃ³Ä‡ premium';
                    restoreBtn.classList.remove('loading');
                },
                showMessage(message, isSuccess) {
                    // UtwÃ³rz element komunikatu
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `billing-message ${isSuccess ? 'success' : 'error'}`;
                    messageDiv.textContent = message;

                    // Dodaj do body
                    document.body.appendChild(messageDiv);

                    // Animacja pojawiania siÄ™
                    setTimeout(() => messageDiv.classList.add('show'), 10);

                    // Automatyczne usuniÄ™cie po 4 sekundach
                    setTimeout(() => {
                        messageDiv.classList.remove('show');
                        setTimeout(() => messageDiv.remove(), 300);
                    }, 4000);
                },
                onStatusChanged(status) {
                    const pill = document.getElementById('premium-status-pill');
                    if (!pill) return;
                    const active = status && status.isActive;
                    pill.textContent = active ? 'Status: Premium aktywne' : 'Status: Standard';
                    pill.classList.toggle('active', !!active);

                    // WyÅ‚Ä…cz przyciski "Aktywuj" jeÅ›li subskrypcja jest aktywna
                    const planButtons = document.querySelectorAll('.plan-button');
                    planButtons.forEach(button => {
                        if (active) {
                            // JeÅ›li subskrypcja jest aktywna, wyÅ‚Ä…cz przyciski
                            button.disabled = true;
                            button.textContent = 'Aktywne';
                            button.classList.add('disabled');

                            // Dodaj atrybut informujÄ…cy o aktywnoÅ›ci subskrypcji
                            button.setAttribute('data-subscription-active', 'true');
                        } else {
                            // JeÅ›li subskrypcja nie jest aktywna, przywrÃ³Ä‡ przyciski
                            button.disabled = false;
                            const planId = button.getAttribute('data-plan-id');
                            button.textContent = 'Aktywuj';
                            button.classList.remove('disabled');
                            button.setAttribute('data-subscription-active', 'false');
                        }
                    });

                    // PokaÅ¼/ukryj sekcjÄ™ zarzÄ…dzania subskrypcjÄ…
                    const manageSection = document.getElementById('premium-manage-section');
                    if (manageSection) {
                        manageSection.style.display = active ? 'block' : 'none';
                    }

                    // Upewnij siÄ™, Å¼e przycisk zarzÄ…dzania jest rÃ³wnieÅ¼ prawidÅ‚owo ustawiony
                    const manageBtn = document.getElementById('manage-subscription');
                    if (manageBtn) {
                        if (active) {
                            manageBtn.disabled = false;
                            manageBtn.textContent = 'ZarzÄ…dzaj subskrypcjÄ…';
                            manageBtn.classList.remove('loading');
                        }
                    }

                    // WyÅ›wietl informacjÄ™ o dacie wygaÅ›niÄ™cia
                    const expiryInfo = document.getElementById('premium-expiry-details');
                    if (expiryInfo) {
                        if (active) {
                            const expiryDate = status.expiryDateFormatted || status.estimatedExpiryDateFormatted;
                            const isExpiringSoon = status.isExpiringSoon;

                            if (expiryDate) {
                                const isEstimated = !status.expiryDateFormatted && status.estimatedExpiryDateFormatted;
                                expiryInfo.innerHTML = `
                                    <div class="expiry-details ${isExpiringSoon ? 'expiring-soon' : ''}">
                                        ${isExpiringSoon ? 'âš ï¸ Twoja subskrypcja wkrÃ³tce wygaÅ›nie!<br>' : ''}
                                        ${isEstimated ? 'Szacowana data wygaÅ›niÄ™cia' : 'Data wygaÅ›niÄ™cia'}: <strong>${expiryDate}</strong>
                                        ${status.autoRenewing ? '<br><span class="auto-renew">âœ“ Odnawiana automatycznie</span>' : ''}
                                    </div>
                                `;
                                expiryInfo.style.display = 'block';
                            } else {
                                expiryInfo.style.display = 'none';
                            }
                        } else {
                            expiryInfo.style.display = 'none';
                        }
                    }
                }
            };

            window.premiumPage = premiumPage;
            document.addEventListener('DOMContentLoaded', () => {
                premiumPage.init();

                // Dodatkowe sprawdzenie po zaÅ‚adowaniu, aby upewniÄ‡ siÄ™ Å¼e sekcja zarzÄ…dzania jest widoczna
                // dajemy chwilÄ™ na zaÅ‚adowanie components.js i inicjalizacjÄ™ statusu
                setTimeout(() => {
                    const status = window.premium?.currentStatus;
                    if (status && status.isActive) {
                        // JeÅ›li status jest aktywny, upewnij siÄ™ Å¼e sekcja zarzÄ…dzania jest widoczna
                        const manageSection = document.getElementById('premium-manage-section');
                        const manageBtn = document.getElementById('manage-subscription');

                        if (manageSection) {
                            manageSection.style.display = 'block';
                        }

                        if (manageBtn) {
                            manageBtn.disabled = false;
                            manageBtn.textContent = 'ZarzÄ…dzaj subskrypcjÄ…';
                            manageBtn.classList.remove('loading');
                        }
                    }
                }, 500);
            });
        })();
    </script>
</body>

</html>